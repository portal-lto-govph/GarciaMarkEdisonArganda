"use strict";dermalog.dl_a_public_portal.digital_id={licenses:null,scenario:"",base64spFront:"",base64spBack:"",base64nonproFront:"",base64nonproBack:"",base64proFront:"",base64proBack:"",base64conFront:"",base64conBack:"",base64dlFront:"",base64dlBack:"",qrCodeSp:"",qrCodeNonPro:"",qrCodePro:"",qrCodeCon:"",qrCodeDL:"",curPid:"",curDoctype:"",curQRCode:null,state:"",errMsgNoLicense:"You do not have a license yet.<br>Please apply for a Student's Permit to generate a Digital ID.",errMsgRevoked:"Your license was revoked.<br>Please apply for a Student''s Permit to generate a Digital ID.",errMsgLegacy:"Your license does not fullfill the requirements, because it is too old.<br>After the creation of your next license the Digital ID will be generated.",errMsgOther:'There seems to be an issue when generating your Digital ID.<br>Please contact <a href="mailto:clientcare@lto.gov.ph">LTO Client Care</a> for more information.',get $imgFront(){return $(".card__face--front canvas")},get $imgBack(){return $(".card__face--back canvas")},get $btnFlip(){return $("#btn-flip-digital-id, #btn-flip-digital-id-ls")},get $btnFlipLabel(){return this.$btnFlip.find(".t-Button-label")},get $btnFlipIcon(){return this.$btnFlip.find(".t-Icon")},get $btnQR(){return $("#btn-qr-digital-id, #btn-qr-digital-id-ls")},get $btnBack(){return $("#btn-back-digital-id, #btn-back-digital-id-ls")},get $btnClose(){return $("#btn-close-digital-id, #btn-close-digital-id-ls")},get $regDialog(){return $('[aria-describedby="reg-digital-id"]')},regDigitalId:"reg-digital-id",get $regDigitalId(){return $("#reg-digital-id")},get $regQRCode(){return $(".qr-box")},get $regImage(){return $(".scene.license-container")},get $regCard(){return $(".card")},get $regWaitBox(){return $(".wait-box")},get $regDigitalIdContainer(){return $("#reg-digital-id .container")},get $regImageRow(){return $("#reg-digital-id .container > .row").eq(0)},get $regListRow(){return $("#reg-digital-id .container > .row").eq(1)},get $regErrorRow(){return $("#reg-digital-id .container > .row").eq(2)},changeFlipBtnText:function(){this.$regCard.hasClass("is-flipped")?this.$btnFlipLabel.html("Frontside"):this.$btnFlipLabel.html("Backside"),this.$btnFlipIcon.addClass("fa-exchange").removeClass("fa-certificate")},initDigitlIdModal:function(e){this.$regImageRow.hide(),this.$regListRow.hide(),this.$regErrorRow.hide(),this.$regDialog.hide();let t=this;this.licenses=e.split(":"),""==this.licenses[0]?this.scenario="NO_LICENSE":1==this.licenses.length?(this.licenses[0].split(",")[4],this.scenario="ONE_LICENSE"):(this.scenario="MULTIPLE_LICENSES",this.$btnBack.each((e,i)=>{$(i).on("click",()=>{t.showDigitalIdList()})})),[this.$regCard,this.$btnFlip].forEach(e=>{e.on("click",()=>{"QR"===this.state?this.showDigitalId(this.curPid,this.curDoctype):(this.$regCard.toggleClass("is-flipped"),this.changeFlipBtnText())})}),this.$btnQR.each((e,i)=>{$(i).on("click",()=>{t.showQRCode()})}),this.$btnClose.each((e,i)=>{$(i).on("click",()=>{t.closeDigitalIdModal()})}),$(window).on("apexwindowresized orientationchange resize",()=>{t.resizeDialogHeight()})},removeStatusFromPage:function(){this.$regDialog.find(".ui-dialog-title .license-status").remove()},openDigitalIdModal:function(){if(openModal(this.regDigitalId),0==$(".ui-dialog-title > span.iconPlaceholder").length&&this.$regDialog.find(".ui-dialog-title").prepend('<span class="iconPlaceholder t-Icon fa fa-certificate"></span>'),this.removeStatusFromPage(),"NO_LICENSE"===this.scenario)this.showAlertError(this.errMsgNoLicense);else if("MULTIPLE_LICENSES"===this.scenario)this.showDigitalIdList();else{let e=this.licenses[0].split(",")[0],t=this.licenses[0].split(",")[2],i=this.licenses[0].split(",")[3],s=this.licenses[0].split(",")[4];this.licenses[0].split(",")[5],"Revoked"==i?this.showAlertError(this.errMsgRevoked):"LEGACY"==s?this.showAlertError(this.errMsgLegacy):this.showDigitalId(e,t)}},closeDigitalIdModal:function(){closeModal(this.regDigitalId)},showWaitingWheel:function(){this.$regQRCode.hide(),this.$regImage.hide(),this.$regWaitBox.show()},showDigitalIdList:function(){this.$btnFlip.hide(),this.$btnQR.hide(),this.$btnBack.hide(),this.$regImageRow.hide(),this.$regListRow.show(),this.$regErrorRow.hide(),this.$regDialog.addClass("dialog-show-list").removeClass("dialog-show-picture").removeClass("dialog-show-alert"),this.removeStatusFromPage(),this.resizeDialogHeight()},showAlertError:function(e){$("#reg-digital-id-error .error-reason").html(e),this.setStatusInTitle(),"MULTIPLE_LICENSES"===this.scenario?this.$btnBack.show():this.$btnBack.hide(),this.$btnClose.show(),this.$btnFlip.hide(),this.$btnQR.hide(),this.$regImageRow.hide(),this.$regListRow.hide(),this.$regErrorRow.show(),this.resizeDialogHeight(),this.$regDialog.removeClass("dialog-show-list").removeClass("dialog-show-picture").addClass("dialog-show-alert")},setStatusInTitle:function(){let e,t;return this.licenses.forEach((i,s)=>{let r=i.split(",");r[0]==this.curPid&&(e=r[3],t=r[6])}),("Active"==e||"Delinquent"==e)&&"Y"==t&&(e="Alarmed"),0===this.$regDialog.find(".ui-dialog-title .license-status").length&&(void 0===e?this.$regDialog.find(".ui-dialog-title").append('<span class="license-status"> is Unavailable</span></span>'):this.$regDialog.find(".ui-dialog-title").append(`<span class="license-status"> is <span>${e}</span></span>`)),"Revoked"==e||"Suspended"==e||"Alarmed"==e?this.$regDialog.find(".ui-dialog-title .license-status > span").addClass("lto_red").removeClass("lto_green").removeClass("lto_blue"):"Delinquent"==e||"Expired"==e?this.$regDialog.find(".ui-dialog-title .license-status > span").removeClass("lto_red").removeClass("lto_green").addClass("lto_blue"):"Active"==e&&this.$regDialog.find(".ui-dialog-title .license-status > span").removeClass("lto_red").addClass("lto_green").removeClass("lto_blue"),e},drawOnCanvas:function(e,t){let i=this.setStatusInTitle(),s=!1,r;"canvas-front"==e&&("Suspended"==i?(s=!0,r=110):("Alarmed"==i||"Revoked"==i)&&(s=!0,r=140));let a=document.getElementById(e),o=a.getContext("2d"),h=new Image(940,602);h.onload=function(){o.canvas.width=h.width,o.canvas.height=h.height,o.drawImage(h,0,0),s&&(o.save(),o.translate(a.width/2,a.height/2),o.rotate(30*Math.PI/180),o.font=`${r}px sans-serif`,o.fillStyle="rgba(225, 0, 23, 0.3)",o.textAlign="center",o.textBaseline="middle",o.fillText(i.toUpperCase(),0,0),o.restore())},h.src="data:image/png;base64,"+t},showDigitalId:function(e,t){this.state="CARD",this.curPid=e,this.curDoctype=t;let i="",s;if(this.licenses.forEach((e,t)=>{let r=e.split(",");r[0]==this.curPid&&(i=r[3],s=r[4])}),""==i)this.showAlertError(this.errMsgNoLicense);else if("Revoked"==i){this.showAlertError(this.errMsgRevoked);return}else if("LEGACY"==s){this.showAlertError(this.errMsgLegacy);return}this.$btnFlip.hide(),this.$btnQR.hide(),this.changeFlipBtnText(),this.$regDialog.addClass("dialog-show-picture").removeClass("dialog-show-list").removeClass("dialog-show-alert"),this.$regImageRow.show(),this.$regListRow.hide(),this.$regErrorRow.hide(),this.resizeDialogHeight(),"MULTIPLE_LICENSES"===this.scenario?this.$btnBack.show():this.$btnBack.hide();let r="",a="";0==t&&""!=this.base64spFront?(r=this.base64spFront,a=this.base64spBack):1==t&&""!=this.base64nonproFront?(r=this.base64nonproFront,a=this.base64nonproBack):2==t&&""!=this.base64proFront?(r=this.base64proFront,a=this.base64proBack):3==t&&""!=this.base64conFront?(r=this.base64conFront,a=this.base64conBack):4==t&&""!=this.base64dlFront&&(r=this.base64dlFront,a=this.base64dlBack),""!=r||""!=a?(this.drawOnCanvas("canvas-front",r),this.drawOnCanvas("canvas-back",a),this.$btnFlip.show(),this.$btnQR.show(),this.$regQRCode.hide(),this.$regImage.show()):(this.showWaitingWheel(),apex.server.process("get_digital_id_pictures",{x01:e},{success:e=>{this.$regWaitBox.hide(),e.hasOwnProperty("Message")?this.showAlertError(this.errMsgOther):(0==t?(this.base64spFront=e.FrontCardImg,this.base64spBack=e.RearCardImg):1==t?(this.base64nonproFront=e.FrontCardImg,this.base64nonproBack=e.RearCardImg):2==t?(this.base64proFront=e.FrontCardImg,this.base64proBack=e.RearCardImg):3==t?(this.base64conFront=e.FrontCardImg,this.base64conBack=e.RearCardImg):4==t&&(this.base64dlFront=e.FrontCardImg,this.base64dlBack=e.RearCardImg),this.drawOnCanvas("canvas-front",e.FrontCardImg),this.drawOnCanvas("canvas-back",e.RearCardImg),this.$btnFlip.show(),this.$btnQR.show(),this.$regImage.show())},error:e=>{this.$regWaitBox.hide(),this.showAlertError(this.errMsgOther)}}))},showQRCode:function(){let e=this.curPid,t=this.curDoctype;this.state="QR",this.$btnFlipLabel.html("Digital ID"),this.$btnFlipIcon.removeClass("fa-exchange").addClass("fa-certificate"),this.$regDialog.addClass("dialog-show-picture").removeClass("dialog-show-list").removeClass("dialog-show-alert"),this.$regImageRow.show(),this.$regListRow.hide(),this.$regErrorRow.hide(),this.$btnQR.hide(),"MULTIPLE_LICENSES"===this.scenario?this.$btnBack.show():this.$btnBack.hide();let i="";0==t&&""!=this.qrCodeSp?i=this.qrCodeSp:1==t&&""!=this.qrCodeNonPro?i=this.qrCodeNonPro:2==t&&""!=this.qrCodePro?i=this.qrCodePro:3==t&&""!=this.qrCodeCon?i=this.qrCodeCon:4==t&&""!=this.qrCodeDL&&(i=this.qrCodeDL),""!=i?(this.curQRCode.makeCode(i),this.setStatusInTitle(),this.$regImage.hide(),this.$regQRCode.show()):(this.showWaitingWheel(),apex.server.process("get_digital_id_qr_url",{x01:e},{success:e=>{0==t?this.qrCodeSp=e.url:1==t?this.qrCodeNonPro=e.url:2==t?this.qrCodePro=e.url:3==t?this.qrCodeCon=e.url:4==t&&(this.qrCodeDL=e.url),null===this.curQRCode?this.curQRCode=new QRCode(document.getElementById("qrcode"),{text:e.url,width:602,height:602}):this.curQRCode.makeCode(e.url),this.$regWaitBox.hide(),this.$regQRCode.show(),this.setStatusInTitle()},error:e=>{this.showAlertError(this.errMsgOther)}}))},resizeDialogHeight:function(){let e=$(window).width(),t=(980<e?980:e)/(940/602)+145;$(window).height(),this.$regImageRow.is(":visible")&&(this.$regDialog.attr("style",`height: ${t}px !important`),this.$regDialog.width()/this.$regDialog.height()>1.65?(this.$regDialog.find(".ui-dialog-titlebar").hide(),this.$regDialog.find(".t-DialogRegion-buttons").hide(),this.$regDigitalIdContainer.attr("style","max-height: none"),$(".ui-dialog").width()-$(".card__face--front canvas").width()<160?$(".card__face").css("justify-content","left"):$(".card__face").css("justify-content","center"),$("#reg-digital-id-picture > table").show(),this.$regDialog.attr("style",`height: ${t}px !important;width: 100% !important`)):(this.$regDialog.find(".ui-dialog-titlebar").show(),this.$regDialog.find(".t-DialogRegion-buttons").show(),this.$regDigitalIdContainer.removeAttr("style"),$(".card__face").css("justify-content",""),$("#reg-digital-id-picture > table").hide())),this.$regErrorRow.is(":visible")&&this.$regDialog.attr("style",`height: ${$("#reg-digital-id-error").height()+178}px !important`),this.$regListRow.is(":visible")&&(this.$regDialog.attr("style",`height: ${$("#reg-digital-id-list").height()+134}px !important`),this.$regDialog.find(".ui-dialog-titlebar").show(),this.$regDialog.find(".t-DialogRegion-buttons").show(),this.$regDigitalIdContainer.removeAttr("style"),$(".card__face").css("justify-content",""),$("#reg-digital-id-picture > table").hide())}};